# Моя раскладка для ErgoDox EZ

![](https://funkyimg.com/i/2LSSg.png)

## Описание

Четыре картинки выше - четыре разных слоя. Обозначение клавиш для включения и выключения слоя: кружочки и квадратики с цифрами. Кружочки - слой включается когда эту клавишу зажимают (аналог шифта), квадратик - слой включается при нажатии этой клавиши один раз (аналог капс лока).

Первые четыре слоя - слои для английского и русского языков. Раскладки соответственно Дворак для программистов и модифицированный Йцукен.

Слой Other (я его называю красным слоем) - слой для всякого, там находятся клавиши для передвижения, F-клавшии и полезные сочетания клавиш, в частности ряд с F10, F11, Ctrl+F10 - слой для дебага.

Следующим идёт слой для Браузера, там есть соответственно кнопки для закрытия вкладки, переключения вкладки, возвращения старой итд.

Для тех, кто не знаком с QMK рассказываю, что реализовано это всё прямо в клавиатуре, весь этот код, что можно модифицировать, заливается в микроконтроллер в клавиатуре, и оттуда управляется. Таким образом, можно даже тетрис на клавиатуре [сделать](https://github.com/danamlund/meckb_tetris).

Для того, чтобы моя раскладка полностью коректно работала, необходимо, чтобы на компьютере стояли стандартные русская и английская раскладки. Так же необходимо, чтобы в операционной системе был один язык для всех окон (такое нельзя сделать для 7, но можно в 10 и для линукса это по умолчанию). Клавиатура прекрасно работает и при подключении к телефону, без установки всяких драйверов.

Картинка делалась в [моей модификации](https://github.com/optozorax/my-keyboard-layout-editor) сайта KLE.

## Фичи раскладки:

* Раскладка для английского: модифицированный дворак для программистов; раскладка для русского: модифицированный йцукен с элементами дворака для программистов. Раскладки задаются в клавиатуре.
* Работает на любом компьютере, где имеются стандартные раскладки QWERTY, ЙЦУКЕН, где одна раскладка для всех окон, переключение языка на Alt+Shift.
* Inverted Shift модификатор для клавиш - это такой модификатор, при котором, если нажат шифт, для этой клавиши шифт отпускается, а затем снова возвращается. Он используется на шифтовом слое английской и русской раскладки, в частности чтобы набирать цифры при зажатом шифте.
* Залипающий шифт - если нажать шифт, а затем отпустить, то он применится к следующей клавише, если прошло менее 1 секунды.
* Запятая с автопробелом.
* Точка с автопробелом и автозалипающим шифтом.
* При нажатии Ctrl, Alt, Win, включается английский слой, и соответственно все модификаторы нажимаются так, как будто сейчас английская раскладка, даже если на самом деле русская.
* Текущий слой, язык или действие залипающего шифта показывается при помощи светодиодов.

## Философия раскладки:

* Доступ к стрелкам осуществляется через слой, при этом стрелки находятся на домашней позиции, что не требует перемещения руки для перемещения курсора.
* Стрелки расположены не в форме перевернутой буквы T, а по горизонтали. Сделано это для того, чтобы не двигать пальцы вверх-вниз, а так же для того, чтобы снизу разместить дубликаты стрелок с нажатым контролом. Стрелки с нажатым контролом использую очень часто, для передвижения по словам, а так же очень быстро переключаюсь с обычных стрелок на стрелки с контролом, что невозможно делать, не будь этих клавиш, ведь невозможно настолько быстро нажимать и отпускать контрол.
* Вверху стрелок есть клавиши Home, End, Page Up, Page Down. Логичней было бы их разместить по-другому: Home, Page Up, Page Down, End, но уже так есть, и я к этому привык.
* Имеются отдельные кнопки для копирования и вставки. Это позволяет намного быстрее редактировать текст и код.
* Имеется отдельная клавиша Ctrl+Z, которая расположена симметрично Esc.
* Любое нажатие модификаторов, кроме Shift, считается грехом, поэтому все частые комбинации с модификаторами вынесены в отдельные слои, в частности красный и зелёный. Благодаря этому я практически никогда не использую Ctrl, Win, Alt.
* На цифровом ряду находятся не цифры, а все небуквенные символы, потому что они нажимаются чаще, чем цифры, цифры же в свою очередь нажимаются только с шифтом.
* На картинке раскладки цвет каждой клавиши означает то, каким пальцем эта клавиша будет нажиматься. Все соотношения цветов и пальцев вполне очевидны, кроме бирюзового. Это цвет клавиш, которые не будут нажиматься из домашней позиции, то есть будут нажиматься любым пальцем, какой попдается под руку, обычно глядя на клавиатуру. Остальные же клавиши нажимаются строго из домашней позиции, не глядя на клавиатуру. Наличие таких клавиш по моему мнению означает, что клавиатура спроектирована недостаточно хорошо для слепого набора, что не все клавиши удобно нажимать из домашней позиции, и такие клавиши надо либо располагать отдельно от основной клавиатуры, как это делается с нумпадом в обычной клавиатуре.

[Аккаунт на клавогонках.](http://klavogonki.ru/u/#/517589/)

## Костыли

Для того, чтобы после автошифта его индикатор горел ровно необходимое число секунд, нужно добавить следующий код в qmk:

В `tmk_core/common/keyboard.h`:
```diff
// ...
+void user_timer(void);
// ...
```

В `tmk_core/common/keyboard.c`:
```diff
// ...
void keyboard_task(void)
{
	// ...

+    user_timer();
}

+__attribute__((weak))
+void user_timer() {
+}
// ...
```

## Heatmap

В основном для своей клавиатуры я разрабатываю инструмент для замера статистики использования, но он может быть использован для любой клавиатуры под управлением QMK, а так же в будущем ожидается и для любых клавиатур. Туда входят: частотность клавиш, частнотность биграмм, процент использования пальцев и множество других вещей. Посмотреть можно в [klavarog/heatmap](https://github.com/klavarog/heatmap).